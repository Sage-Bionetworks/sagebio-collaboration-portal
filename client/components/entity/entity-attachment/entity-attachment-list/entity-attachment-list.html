<h3>Attachments</h3>

<mat-progress-spinner
    *ngIf="attachmentsDownloadProgress > 0 && attachmentsDownloadProgress < 100; else showAttachments"
    [value]="attachmentsDownloadProgress"
></mat-progress-spinner>

<ng-template #showAttachments>
    <span *ngIf="(attachments | async).length < 1; else showAttachmentList">There are 0 attachments.</span>
    <ng-template #showAttachmentList>
        <mat-nav-list>
            <mat-list-item
                class="app-entity-attachment-bundle"
                *ngFor="let attachment of attachments | async"
                [routerLink]="getEntityLink(attachment.entity, attachment.attachment.entityType)"
            >
                <img matListAvatar [src]="attachment.entity.picture" aria-label="Entity picture" />
                <h3 class="app-entity-attachment-bundle-title" matLine>{{ attachment.entity.title }}</h3>
                <h3 class="app-entity-attachment-bundle-entity-type" matLine>
                    {{ getEntityTypeAndSubType(attachment) }}
                </h3>
                <!-- <button mat-icon-button (click)="showInfo(link)">
                            <mat-icon>info</mat-icon>
                        </button> -->
                <button
                    *ngIf="!isReadOnly"
                    mat-icon-button
                    (click)="removeAttachment($event, attachment)"
                    [matTooltip]="'Remove ' + getEntityTypeAndSubType(attachment)"
                    matTooltipPosition="before"
                >
                    <mat-icon>clear</mat-icon>
                </button>
            </mat-list-item>
        </mat-nav-list>
    </ng-template>
</ng-template>

<form *ngIf="!isReadOnly" [formGroup]="attachmentForm">
    <mat-form-field>
        <mat-label>Type</mat-label>
        <select matNativeControl formControlName="attachmentType" required>
            <option *ngFor="let option of attachmentTypes" [value]="option.value">{{ option.name }}</option>
        </select>
    </mat-form-field>
    <mat-form-field class="app-add-collaborator-field">
        <input
            matInput
            placeholder="Attachment"
            formControlName="attachment"
            [errorStateMatcher]="matcher"
            [matAutocomplete]="auto"
            [readonly]="disabled"
        />
        <mat-autocomplete #auto="matAutocomplete" flex>
            <mat-option *ngFor="let attachment of attachmentSearchResults" [value]="attachment.entity.title" (click)="addAttachment(attachment)">
                <!-- <user-avatar [user]="user" [size]="optionAvatarSize"></user-avatar> -->
                <span>{{ user.username }}</span>
            </mat-option>
        </mat-autocomplete>
        <mat-error *ngIf="attachmentForm.controls.attachment.invalid">
            Please enter a valid attachment.
        </mat-error>
    </mat-form-field>
    <!-- <a mat-raised-button class="app-add-collaborator-button" color="primary" [disabled]="!selectedUser" (click)="addCollaborator()">Add collaborator</a> -->
    <mat-error *ngIf="errors.attachmentForm">
        {{ errors.attachmentForm }}
    </mat-error>
</form>

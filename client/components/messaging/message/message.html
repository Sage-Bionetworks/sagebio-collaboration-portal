<div class="app-message" *ngIf="message">
    <div class="app-message-header">
        <user-avatar class="app-message-header-avatar" [user]="message.createdBy" [size]="avatarSize"></user-avatar>
        <div class="app-message-header-metadata">
            <div class="app-message-header-metadata-line">
                <span class="app-message-header-author">{{ message.createdBy.username }}</span>
                <span class="app-message-header-time" matTooltip="{{ message.createdAt | dateAndTime }}" [matTooltipPosition]="tooltipPosition">{{ message.createdAt | date: 'shortTime' }}</span>
                <span *ngIf="edited" [matTooltip]="message.updatedAt | date: 'shortTime'" matTooltipPosition="right">(edited)</span>
            </div>
        </div>

        <div class="app-message-header-reply-button">
            <message-reply-button *ngIf="showReplyButton" [message]="message"></message-reply-button>
        </div>

        <div class="app-message-header-actions">
            <a *ngIf="showStartThreadButton" mat-icon-button [matTooltip]="(numReplies | async) == 0 ? 'Start a thread' : 'Reply to thread'" [matTooltipPosition]="tooltipPosition" [matTooltipShowDelay]="tooltipShowDelay" aria-label="Start a thread"
              (click)="replyToMessage()">
                <mat-icon aria-label="Icon of a chat bubble outline">chat_bubble_outline</mat-icon>
            </a>

            <message-star-button [message]="message"></message-star-button>

            <a mat-icon-button [matMenuTriggerFor]="moreActionsMenu" matTooltip="More actions" [matTooltipPosition]="tooltipPosition" aria-label="More actions">
                <mat-icon aria-label="Icon of three horizontal dots">more_horiz</mat-icon>
            </a>
            <mat-menu #moreActionsMenu="matMenu" xPosition="before" [overlapTrigger]="false">
                <button mat-menu-item aria-label="Edit message" (click)="isReadOnly = false">
                    <span>Edit message</span>
                </button>
                <button mat-menu-item aria-label="Delete message" (click)="removeMessage()">
                    <span class="app-message-delete-btn-label">Delete message</span>
                </button>
                <message-star-archive-button *ngIf="starred | async" [message]="message"></message-star-archive-button>
            </mat-menu>
        </div>
    </div>

    <form [formGroup]="form" class="app-message-body">
        <quill-editor class="app-message-ql-editor" #editor [readOnly]="isReadOnly" format="object" (keydown.enter)="$event.stopPropagation()" [formControl]="form.controls['body']">
            <div [hidden]="isReadOnly" quill-editor-toolbar class="app-quill-editor-toolbar"></div>
        </quill-editor>
        <div class="app-message-actions">
            <a class="app-message-actions-update-btn" mat-raised-button [hidden]="isReadOnly" color="primary" [disabled]="form.invalid" (click)="updateMessage()">Update</a>
        </div>
    </form>
</div>
